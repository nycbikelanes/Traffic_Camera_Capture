name: Submit Report

on:
  push:
    branches:
      - main

jobs:
  submit_report:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Get latest image
      run: |
        latest_image=$(ls -t images/*/ | head -n1)
        echo "::set-output name=latest_image::$latest_image"

    - name: Submit Report
      run: |
        latest_image_path=$(cat ${{ steps.get_latest_image.outputs.latest_image }})
        curl 'https://reported-web.herokuapp.com/submit' \
          -X POST \
          -H 'sec-ch-ua: "Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"' \
          -H 'Accept: application/json, text/plain, */*' \
          -H 'Content-Type: multipart/form-data; boundary=----WebKitFormBoundary3c2Ak7XJkuR2mzCo' \
          -H 'Referer: https://reported-web.herokuapp.com/' \
          -H 'sec-ch-ua-mobile: ?0' \
          -H 'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36' \
          -H 'sec-ch-ua-platform: "Windows"' \
          --form "email=${{ secrets.EMAIL }}" \
          --form "password=${{ secrets.PASSWORD }}" \
          --form "FirstName=${{ secrets.FIRST_NAME }}" \
          --form "LastName=${{ secrets.LAST_NAME }}" \
          --form "Phone=${{ secrets.PHONE }}" \
          --form "testify=true" \
          --form "plate=TEST" \
          --form "licenseState=NY" \
          --form "typeofcomplaint=Blocked the bike lane" \
          --form "reportDescription=" \
          --form "can_be_shared_publicly=true" \
          --form "latitude=40.692752" \
          --form "longitude=-73.9885422" \
          --form "coordsAreInNyc=true" \
          --form "formatted_address=345 Adams St, Brooklyn, NY 11201, USA" \
          --form "CreateDate=$(date -u +"%Y-%m-%dT%H:%M:%S.000Z")" \
          --form "attachmentData[]=@$latest_image_path;type=image/png" \
          --compressed
